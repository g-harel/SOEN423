#!/bin/bash

clear

ORB_PORT=1051

IDL_PATH=src/Hello.idl
BIN_PATH=$(pwd)/bin

CLIENT_CLASS=HelloClient
SERVER_CLASS=HelloServer

function printStep {
    echo -e "\n >> \e[1;35m$1\e[0m\n"
}

function sketchyWait {
    sleep 0.314159
}

printStep "compiling idl interface"
idlj -fall -td src $IDL_PATH

printStep "compiling source"
mkdir -p bin
javac -d $BIN_PATH src/*.java src/**/*.java

if [[ $1 == "build" ]]; then
    echo
    exit 0
fi

printStep "starting naming service"
pkill orbd
sketchyWait
orbd -ORBInitialPort $ORB_PORT&
sketchyWait

cd $BIN_PATH

printStep "starting server"
java $SERVER_CLASS -ORBInitialPort $ORB_PORT&

sketchyWait

printStep "starting client"
java $CLIENT_CLASS -ORBInitialPort $ORB_PORT

sketchyWait

kill $(jobs -p)
